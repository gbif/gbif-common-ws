<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ClientInvocationHandlerFactory.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">GBIF Common Web service</a> &gt; <a href="index.source.html" class="el_package">org.gbif.ws.client</a> &gt; <span class="el_source">ClientInvocationHandlerFactory.java</span></div><h1>ClientInvocationHandlerFactory.java</h1><pre class="source lang-java linenums">package org.gbif.ws.client;

import feign.InvocationHandlerFactory;
import feign.Target;

import java.lang.reflect.InvocationHandler;
import java.lang.reflect.Method;
import java.lang.reflect.Proxy;
import java.util.Map;
import java.util.Optional;

import static feign.Util.checkNotNull;

@SuppressWarnings(&quot;unused&quot;)
<span class="nc" id="L15">public class ClientInvocationHandlerFactory implements InvocationHandlerFactory {</span>

  @Override
  public InvocationHandler create(Target target, Map&lt;Method, MethodHandler&gt; dispatch) {
<span class="nc" id="L19">    return new ClientInvocationHandlerFactory.FeignInvocationHandler(target, dispatch);</span>
  }

  static class FeignInvocationHandler implements InvocationHandler {

    private final Target target;
    private final Map&lt;Method, MethodHandler&gt; dispatch;

<span class="nc" id="L27">    FeignInvocationHandler(Target target, Map&lt;Method, MethodHandler&gt; dispatch) {</span>
<span class="nc" id="L28">      this.target = checkNotNull(target, &quot;target&quot;);</span>
<span class="nc" id="L29">      this.dispatch = checkNotNull(dispatch, &quot;dispatch for %s&quot;, target);</span>
<span class="nc" id="L30">    }</span>

    @Override
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
<span class="nc bnc" id="L34" title="All 2 branches missed.">      if (&quot;equals&quot;.equals(method.getName())) {</span>
        try {
          Object otherHandler =
<span class="nc bnc" id="L37" title="All 4 branches missed.">              args.length &gt; 0 &amp;&amp; args[0] != null ? Proxy.getInvocationHandler(args[0]) : null;</span>
<span class="nc" id="L38">          return equals(otherHandler);</span>
<span class="nc" id="L39">        } catch (IllegalArgumentException e) {</span>
<span class="nc" id="L40">          return false;</span>
        }
<span class="nc bnc" id="L42" title="All 2 branches missed.">      } else if (&quot;hashCode&quot;.equals(method.getName())) {</span>
<span class="nc" id="L43">        return hashCode();</span>
<span class="nc bnc" id="L44" title="All 2 branches missed.">      } else if (&quot;toString&quot;.equals(method.getName())) {</span>
<span class="nc" id="L45">        return toString();</span>
      }

<span class="nc" id="L48">      return getMethodHandler(method).invoke(args);</span>
    }

    private MethodHandler getMethodHandler(Method method) {
<span class="nc" id="L52">      MethodHandler methodHandler = dispatch.get(method);</span>

      // if the result is not null just return the handler
<span class="nc bnc" id="L55" title="All 2 branches missed.">      if (methodHandler != null) {</span>
<span class="nc" id="L56">        return methodHandler;</span>
      }

      // if not we have to find another handler
<span class="nc" id="L60">      Optional&lt;Method&gt; anotherMethod = dispatch.keySet().stream()</span>
<span class="nc bnc" id="L61" title="All 2 branches missed.">          .filter(methodFromDispatch -&gt; !methodFromDispatch.equals(method))</span>
<span class="nc" id="L62">          .filter(methodFromDispatch -&gt; methodFromDispatch.getName().equals(method.getName()))</span>
<span class="nc bnc" id="L63" title="All 2 branches missed.">          .filter(methodFromDispatch -&gt; methodFromDispatch.getParameterCount() == method.getParameterCount())</span>
<span class="nc" id="L64">          .findFirst();</span>

<span class="nc" id="L66">      return anotherMethod.map(dispatch::get)</span>
<span class="nc" id="L67">          .orElse(null);</span>
    }

    @Override
    public boolean equals(Object obj) {
<span class="nc bnc" id="L72" title="All 2 branches missed.">      if (obj instanceof ClientInvocationHandlerFactory.FeignInvocationHandler) {</span>
<span class="nc" id="L73">        ClientInvocationHandlerFactory.FeignInvocationHandler other = (ClientInvocationHandlerFactory.FeignInvocationHandler) obj;</span>
<span class="nc" id="L74">        return target.equals(other.target);</span>
      }
<span class="nc" id="L76">      return false;</span>
    }

    @Override
    public int hashCode() {
<span class="nc" id="L81">      return target.hashCode();</span>
    }

    @Override
    public String toString() {
<span class="nc" id="L86">      return target.toString();</span>
    }
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span></div></body></html>